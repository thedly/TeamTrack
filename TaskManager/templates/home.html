{% load apptags %}
{% load static %}
<!doctype>
<html>
<head>
	<link rel="stylesheet" href="{% static "css/style.css" %}">
	<script src="{% static "js/jquery.js" %}"></script>
	<script src="{% static "js/socket.io.js" %}"></script>
	
	
	<script>
		$(document).ready(function(){
			$('#OnlineUsersDiv').width(($('body').width()-960)/2)
			
			$.ajax({
				url:"/TaskManager/getip/",
				type:"get",
				success:function(result){
					alert(result)
				    $("#ip").html(result);
				  }});
			})
			
			
			
		})
	</script>
	<script>
	  if(typeof(EventSource)!=="undefined")
	  {
	  var source=new EventSource("{% url 'serversideevents' %}");
	  source.onmessage=function(event)
		{
		console.log(event.data)
		document.getElementById("result").innerHTML+=event.data + "<br>";
		};
	  }
	else
	  {
	  document.getElementById("result").innerHTML="Sorry, your browser does not support server-sent events...";
	  }
	</script>
	
	<script>

var x=document.getElementById("demo");

function getLocation()

  {

  if (navigator.geolocation)

    {

    navigator.geolocation.getCurrentPosition(showPosition,showError);

    }

  else{x.innerHTML="Geolocation is not supported by this browser.";}

  }

 

function showPosition(position)

  {

  var latlon=position.coords.latitude+","+position.coords.longitude;

 

  var img_url="http://maps.googleapis.com/maps/api/staticmap?center="

  +latlon+"&zoom=14&size=400x300&sensor=false";

  document.getElementById("mapholder").innerHTML="<img src='"+img_url+"'>";

  }

 

function showError(error)

  {

  switch(error.code)

    {

    case error.PERMISSION_DENIED:

      x.innerHTML="User denied the request for Geolocation."

      break;

    case error.POSITION_UNAVAILABLE:

      x.innerHTML="Location information is unavailable."

      break;

    case error.TIMEOUT:

      x.innerHTML="The request to get user location timed out."

      break;

    case error.UNKNOWN_ERROR:

      x.innerHTML="An unknown error occurred."

      break;

    }

  }

</script>

</head>
<body onload="getLocation()">

			<div id="events">
				
			</div>
			
			
			<div class="HomeOuterDiv">
			
			<div id="MainHeader">
			<h1>TEAM TRACK</h1>
			</div>
			
			<div id="MenuButtonsWrapper">
				<a href="{% url 'projects' %}"><div class="menuBtnBig">Projects</div></a>
				<a href="{% url 'profileslist' %}"><div class="menuBtnBig" id="profileIcon">Profiles</div></a>
				<a href="{% url 'CalenderEvents' %}"><div class="menuBtnBig">Calendar</div></a>
			</div>
			<div id="SearchBarDiv">
				<form method="get" action="{% url 'searchresults' %}">
					<input name="Search" class="varchardata" placeholder="Search for projects,tasks & profiles" id="MainSearchBar" lang="en" x-webkit-speech>
					<button type="submit" id="searchsubmit"></button>
				</form>
				
			</div>
			
			
		  </div>
		  
		  <div  class="HomeOuterDiv">
		  <div id="loggedinDetails">
		  	<table>
		  		<tr>
		  			<td>
		  				USER:
		  			</td>
		  			<td>
		  				{{ request.user.username }}
		  			</td>
		  		</tr>
		  		<tr>
		  			<td>
		  			IP:
		  			</td>
		  			<td>
		  			{{ ip }}
		  			</td>
		  		</tr>
		  	</table>
		  </div>
		  
		  <div id="mapholder"></div>
		  </div>
		  
			  
		  {% if tasksPending %}
		  <div class="HomeOuterDiv">
<table id="tblList">
<tr>
	<th>
		Task title
	</th>
	<th>
		status
	</th>
	<th>
		No. of days remaining
	</th>
</tr>
{% for task in tasksPending %}
	
	<tr class="hovereffect" >	
		<td>
			<a href="{% url 'taskdetail' task.id %}" style="text-decoration:none">{{ task }}</a>
		</td>
		<td>
			<a href="{% url 'taskdetail' task.id %}" style="text-decoration:none">{{ task.Status }}</a>
		</td>
		<td>
			{{ task.EndDate.date.day|subtractDates }} 
		</td>
		<td>
			{% if task.Status.id == 4 %}
			<div class="signal" style="background-color:green;"></div>
			{% elif task.Status.id == 3 %}
			<div class="signal" style="background-color:orange;"></div>
			{% else %}
			<div class="signal" style="background-color:red;"></div>
			{% endif %}
		</td>
</tr>
{% endfor %}
	</table>
</div>
{% endif %}
		  
		  
		  
		  
		  <div id="Homefooter">
				Copyrights 2013 Achumen Technologies Pvt Ltd.
			</div>
		  
</body>
</html>