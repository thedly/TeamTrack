{% load static %}


<html>
    <head>
    
    <link href="{% static "css/bootstrap.css" %}" rel="stylesheet" type="text/css" />
    <link href="{% static "css/farbtastic.css" %}" rel="stylesheet" type="text/css" />
    <link href="{% static "css/freshereditor.css" %}" rel="stylesheet" type="text/css" />
    
    <script type="text/javascript" src="{% static "js/jquery.js" %}"></script>
    <script src="{% static "js/jquery.min.js" %}" type="text/javascript"></script>
    <script src="{% static "js/shortcut.js" %}" type="text/javascript"></script>
    <script src="{% static "js/farbtastic.js" %}" type="text/javascript"></script>
    <script src="{% static "js/bootstrap-dropdown.js" %}" type="text/javascript"></script>	
    <script src="{% static "js/freshereditor.min.js" %}" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#content-editor').freshereditor({toolbar_selector: "#toolbar", excludes: ['removeFormat', 'insertheading4']});
            $("#content-editor").freshereditor("edit", true);
            $("#content-editor").on('change', function() {
               console.log("content changed");
            });
        });
    </script>
    <script>
	$(function(){
		var parseddata = $.parseJSON($("#userobj").text());
		$("#SelectUsersTo").click(function(){
			var userarr = [];
			$.each($("#id_UsersTo").val(),function(skey,svalue){
				$(parseddata).each(function(key,value){
					if(Number(svalue)==Number(value.id))
					{
						userarr.push(value.name+"<"+value.email+">")	
					}
				})
			})
			$("#id_To").val(userarr)
		})
		
		$(window).blur(function(){
			window.close();
		})
		
		
		$("#SelectUsersCc").click(function(){
			var userarr = [];
			$.each($("#id_UsersCc").val(),function(skey,svalue){
				$(parseddata).each(function(key,value){
					if(Number(svalue)==Number(value.id))
					{
						userarr.push(value.name+"<"+value.email+">")	
					}
				})
			})
			$("#id_Cc").val(userarr)
		})
		
	})
</script>
    
    
     <style type="text/css">
        #content-editor {
           margin: 50px 10px 10px 10px;
        }
        #toolbar {
           margin:10px;
        }
    </style>
    </head>
    <body>
        <div id="toolbar"></div>
            <div id="content-editor" class="clear">
                <span>Edit me here</span>
            </div>
        <h1>Mail</h1>
	<pre id="userobj" style="display:none">
		[
		{% for user in Users %}
		{
			"id":{{ user.id }},"email": "{{ user.email }}","name":"{{ user.username }}"
		}
		{% if not forloop.last %}
		,
		{% endif %}
		{% endfor %}	
		]
	</pre>

<form method="post" action="">{% csrf_token %}
<table>
	<tr>
		<td>{{ form.To }}</td>
	</tr>
	<tr>
		<td>{{ form.UsersTo }}</td>
		<td><button type="button" id="SelectUsersTo">Confirm</button></td>
	</tr>
	<tr>
		<td>{{ form.Cc }}</td>
	</tr>
	<tr>
		<td>{{ form.UsersCc }}</td>
		<td><button type="button" id="SelectUsersCc">Confirm</button></td>
	</tr>
	<tr>
	</tr>
</table>
<button type="submit">Submit</button>
</form>
    </body>
</html>



