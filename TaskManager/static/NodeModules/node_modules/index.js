var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);

var clients =[];

io.on('connection', function(socket){
  console.log('user connected');
  socket.on('storeClientInfo', function (data) {
        var clientInfo = new Object();
        clientInfo.customName         = data.customName;
        clientInfo.customId         = data.customId;
        clientInfo.clientId     = socket.id;

        if(clients.indexOf(clientInfo) == -1);
        {
            clients.push(clientInfo);
        }
        socket.emit('Clients', clients);
    });

  socket.on('disconnect', function(data){
    for( var i=0, len=clients.length; i<len; ++i ){
                var c = clients[i];

                if(c.clientId == socket.id){
                    clients.splice(i,1);
                    break;
                }
            }
    socket.emit('Clients', clients);
    console.log('user disconnected');
  });
});

io.on('connection', function(socket){


  socket.on('chatMessageToAll', function(msg){
    console.log(msg)
    socket.emit('ReceiveFromAll', msg);
  });

  socket.on('chat message', function(msg){
    console.log(msg)
    socket.emit(msg.clientId, msg.message);
    console.log(msg.clientId, msg.message)
  });
});

http.listen(3000, function(){
  console.log('listening on *:3000');
});


