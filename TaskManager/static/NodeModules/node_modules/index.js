var app = require('express')();
var http = require('http').Server(app);
var io = require('socket.io')(http);

var clients =[];

io.on('connection', function(socket){
  socket.on('storeClientInfo', function (data) {
        var clientInfo = new Object();
        clientInfo.customId         = data.customId;
        clientInfo.clientId     = socket.id;
        clients.push(clientInfo);
        socket.emit('Clients', clients);
    });

  socket.on('disconnect', function(data){
    for( var i=0, len=clients.length; i<len; ++i ){
                var c = clients[i];

                if(c.clientId == socket.id){
                    clients.splice(i,1);
                    break;
                }
            }
    socket.emit('Clients', clients);
    console.log('user disconnected');
  });
});

io.on('connection', function(socket){
  socket.on('chat message', function(msg){
    socket.emit('ReceiveMsg', msg);
    console.log('message: ' + msg);
  });
});

http.listen(3000, function(){
  console.log('listening on *:3000');
});


